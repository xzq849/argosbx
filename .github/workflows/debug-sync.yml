# è°ƒè¯•ç‰ˆæœ¬çš„ä¸Šæ¸¸åŒæ­¥å·¥ä½œæµ
name: Debug Upstream Sync

# æ‰‹åŠ¨è§¦å‘
on:
  workflow_dispatch:

jobs:
  debug-sync:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
      - name: ðŸ“¥ æ£€å‡ºä»“åº“
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: âš™ï¸ é…ç½®Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"

      - name: ðŸ” è¯¦ç»†ç½‘ç»œè¯Šæ–­
        run: |
          echo "=== ç½‘ç»œè¯Šæ–­å¼€å§‹ ==="
          
          echo "1. æµ‹è¯•åŸºæœ¬ç½‘ç»œè¿žæŽ¥:"
          ping -c 3 8.8.8.8 || echo "æ— æ³•ping 8.8.8.8"
          
          echo "2. æµ‹è¯•GitHubè¿žæŽ¥:"
          ping -c 3 github.com || echo "æ— æ³•ping github.com"
          
          echo "3. æµ‹è¯•DNSè§£æž:"
          nslookup github.com || echo "DNSè§£æžå¤±è´¥"
          
          echo "4. æµ‹è¯•HTTPè¿žæŽ¥åˆ°GitHub:"
          curl -v -I https://github.com 2>&1 | head -20
          
          echo "5. æµ‹è¯•ç‰¹å®šä»“åº“HTTPè®¿é—®:"
          curl -v -I https://github.com/yonggekkk/argosbx 2>&1 | head -20
          
          echo "6. æµ‹è¯•GitHub API:"
          curl -s https://api.github.com/repos/yonggekkk/argosbx | head -10
          
          echo "=== ç½‘ç»œè¯Šæ–­ç»“æŸ ==="

      - name: ðŸ”— å°è¯•æ·»åŠ ä¸Šæ¸¸ä»“åº“
        continue-on-error: true
        run: |
          echo "=== Gitæ“ä½œæµ‹è¯•å¼€å§‹ ==="
          
          echo "1. æ˜¾ç¤ºå½“å‰Gité…ç½®:"
          git config --list | grep -E "(user|remote)" || true
          
          echo "2. æ˜¾ç¤ºå½“å‰è¿œç¨‹ä»“åº“:"
          git remote -v || true
          
          echo "3. å°è¯•æ·»åŠ ä¸Šæ¸¸ä»“åº“:"
          git remote add upstream https://github.com/yonggekkk/argosbx.git || echo "æ·»åŠ è¿œç¨‹ä»“åº“å¤±è´¥"
          
          echo "4. æ˜¾ç¤ºæ›´æ–°åŽçš„è¿œç¨‹ä»“åº“:"
          git remote -v || true
          
          echo "5. å°è¯•èŽ·å–ä¸Šæ¸¸ä»“åº“ä¿¡æ¯ï¼ˆè¶…æ—¶30ç§’ï¼‰:"
          timeout 30 git ls-remote upstream || echo "ls-remoteå¤±è´¥"
          
          echo "6. å°è¯•fetchä¸Šæ¸¸ä»“åº“ï¼ˆè¶…æ—¶60ç§’ï¼‰:"
          timeout 60 git fetch upstream || echo "fetchå¤±è´¥"
          
          echo "=== Gitæ“ä½œæµ‹è¯•ç»“æŸ ==="

      - name: ðŸ“Š ç”Ÿæˆè¯Šæ–­æŠ¥å‘Š
        if: always()
        run: |
          echo "## ðŸ” ä¸Šæ¸¸åŒæ­¥è¯Šæ–­æŠ¥å‘Š" >> $GITHUB_STEP_SUMMARY
          echo "**è¯Šæ–­æ—¶é—´:** $(date -u '+%Y-%m-%d %H:%M:%S UTC')" >> $GITHUB_STEP_SUMMARY
          echo "**ç›®æ ‡ä»“åº“:** https://github.com/yonggekkk/argosbx" >> $GITHUB_STEP_SUMMARY
          echo "**è¿è¡ŒçŽ¯å¢ƒ:** Ubuntu Latest" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "è¯·æŸ¥çœ‹ä¸Šè¿°æ­¥éª¤çš„è¯¦ç»†æ—¥å¿—æ¥è¯Šæ–­è¿žæŽ¥é—®é¢˜ã€‚" >> $GITHUB_STEP_SUMMARY